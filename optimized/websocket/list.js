(function(){function r(e){if(!(this instanceof r))return new r(e);n.call(this);var i=this;typeof e=="undefined"&&(e={}),i.encoding=e.encoding,i.construct=e.construct||t;var s={next:null,buffer:null},o={next:null,buffer:null},u=0;i.__defineGetter__("length",function(){return u});var a=0;i.write=function(e){return s.buffer?(o.next={next:null,buffer:e},o=o.next):(s.buffer=e,o=s),u+=e.length,i.emit("write",e),!0},i.end=function(e){t.isBuffer(e)&&i.write(e)},i.push=function(){var e=[].concat.apply([],arguments);return e.forEach(i.write),i},i.forEach=function(e){if(!s.buffer)return new i.construct(0);if(s.buffer.length-a<=0)return i;var t=s.buffer.slice(a),n={buffer:t,next:s.next};while(n&&n.buffer){var r=e(n.buffer);if(r)break;n=n.next}return i},i.join=function(e,t){if(!s.buffer)return new i.construct(0);e==undefined&&(e=0),t==undefined&&(t=i.length);var n=new i.construct(t-e),r=0;return i.forEach(function(i){e<r+i.length&&r<t&&i.copy(n,Math.max(0,r-e),Math.max(0,e-r),Math.min(i.length,t-r)),r+=i.length;if(r>t)return!0}),n},i.joinInto=function(e,t,n,r){if(!s.buffer)return new i.construct(0);n==undefined&&(n=0),r==undefined&&(r=i.length);var o=e;if(o.length-t<r-n)throw new Error("Insufficient space available in target Buffer.");var u=0;return i.forEach(function(e){n<u+e.length&&u<r&&e.copy(o,Math.max(t,t+u-n),Math.max(0,n-u),Math.min(e.length,r-u)),u+=e.length;if(u>r)return!0}),o},i.advance=function(e){a+=e,u-=e;while(s.buffer&&a>=s.buffer.length)a-=s.buffer.length,s=s.next?s.next:{buffer:null,next:null};return i.emit("advance",e),i},i.take=function(e,t){e==undefined?e=i.length:typeof e!="number"&&(t=e,e=i.length);var n=s;t||(t=i.encoding);if(t){var r="";return i.forEach(function(n){if(e<=0)return!0;r+=n.toString(t,0,Math.min(e,n.length)),e-=n.length}),r}return i.join(0,e)},i.toString=function(){return i.take("binary")}}var e=require,t=e("buffer").Buffer,n=e("events").EventEmitter;module.exports=r,e("util").inherits(r,n)})()