(function(){var e=require("./g"),t=require("./agent"),n=require("./types"),r=require("./maps/outside");module.exports=function(s,o,u){var a=this,f=0;a.age=0,a.tps=1,a.sps=60,a.density=u||1,a.width=s||30,a.height=o||30,a.types=n,a.map=r(a),a.agents={},a.agentsCount=0,a.datetime=new Date,a.sunlight=1,a.spawn=function(n){function i(e){if(e.dir!==undefined&&e.dir!==null){var t=e.dir;t<0&&(t=7),t>7&&(t=0),r.dir=t}if(e.walk!=undefined){var n=0,i=0,s=e.walk;s>1&&(s=1),t==0?(n=0,i=-s):t==1?(n=s,i=-s):t==2?(n=s,i=0):t==3?(n=s,i=s):t==4?(n=0,i=s):t==5?(n=-s,i=s):t==6?(n=-s,i=0):t==7&&(n=-s,i=-s);var o,u;o=r.x+n,u=r.y+i,o>=a.width&&(o=0),o<0&&(o=a.width-1),u>=a.height&&(u=0),u<0&&(u=a.height-1);var f=a.map[o+"-"+u];if(f){var l=a.types[f.type];l.solid&&(o=r.x,u=r.y)}r.x=o,r.y=u}e.next!==undefined&&(r.next=e.next)}function s(){delete a.agents[r.id]}f++;var r=new t(f,e.rnd(a.width-10)+5,e.rnd(a.height-10)+5,n,s,i);return a.agents[r.id]=r,a},a.start=function(e,t){return e&&(a.tps=e),t&&(a.spt=t),setInterval(function(){a.tick()},1e3/a.tps),a},a.tick=function(){var e=a.datetime;e.setSeconds(e.getSeconds()+a.spt);var t=e.getHours()+e.getMinutes()/60;a.sunlight=1-Math.abs(t-12)/12,a.age++;for(var n in a.agents)a.agents[n].act(a)}}})()