(function(){function o(e){var n="",r;for(var i in e)r=e[i],n+="<li>"+Math.abs(r.health*100)+" - "+r.id+" - "+r.type+"</li>";t.innerHTML=n}function u(e,t,n){var r,i="",s,o,u=8,a=8,f,l,c;for(r in e)c=e[r],s=t[c.type],f=c.x*a,l=c.y*u,i+="<span class='block' style='width: "+a+"px; height: "+u+"px; left: "+f+"px; top: "+l+"px; color:"+s.color+"; background: "+s.bgcolor+" '>"+s.symbol+"</span>";n.innerHTML=i}function a(e){var t=new Date(e.datetime);s.innerHTML="#map { -webkit-filter: opacity("+(e.sunlight+.2)+"); }",n.innerHTML=t.toTimeString()}function f(e){var t={},n;for(var r in e.agents)n=e.agents[r],t[n.x+"-"+n.y]=n;return t}function l(e,t){var n=this,s={};this.action=e||function(){},t.onopen=function(){console.log("Connection open!"),n.send({next:{ready:!0,map:!0,agents:!0,types:!0}})},t.onmessage=function(e){var t=JSON.parse(e.data);a(t),s.tps=t.tps,s.age=t.age,t.types&&(s.types=t.types),t.agents&&(s.agents=t.agents,s.agentsMap=f(s),u(s.agentsMap,s.types,i)),t.map&&(s.map=t.map,s.width=t.width,s.height=t.height,u(s.map,s.types,r)),t.agents&&o(t.agents);var l=n.action(s,t.self);l.next={ready:!0,agents:!0},n.send(l)},n.send=function(e){t.send(JSON.stringify(e))}}function c(e){return Math.floor(Math.random()*e)}function h(e,t){var n=t.dir,r=c(4),i=c(3),s=c(3);return i||(n=t.dir+s-1),{dir:n,walk:r?1:0}}var e=document,t=e.getElementById("agentList"),n=e.getElementById("worldStats"),r=e.getElementById("map"),i=e.getElementById("agents"),s=e.getElementById("css"),p=[];for(var d=0;d<1;d++){var v=new WebSocket("ws://localhost:5000/");p.push(new l(h,v))}console.log("spawned agents!",p)})()