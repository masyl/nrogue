(function(e){function I(){t.onfocus=function(){h=!0},t.onblur=function(){h=!1},t.onkeypress=function(e){return e.preventDefault(),!1},s.onclick=function(e){e.preventDefault()},s.onmouseout=function(e){a=n},s.onmousemove=function(e){e.preventDefault();var t=_(e.layerX/l),r=_(e.layerY/l);isNaN(t)?a=n:a={x:t,y:r}};for(r=0;r<1;r++)C.push(new z(e.ai.human,new WebSocket("ws://"+i.location.host)))}function q(e,t){x=n;if(v&&!S){B(),w=1;for(r in v)b=v[r],U(b.x,b.y,p[b.type]);j(),S=o.getImageData(0,0,f*l,f*l)}else v&&S&&o.putImageData(S,0,0);B(),o.fillStyle=L+e.sunlight*.7+")",o.rect(0,0,f*l,f*l),j();if(C){B();for(r in C)m=C[r],m.id===E.id?d=p.you:d=p[m.type],U(m.x,m.y,d);j()}k=f*l,B(),o.arc(E.x*l,E.y*l,E.vision*l,0,D*2,!1),H(k,E.y*l),H(k,0),H(0,0),H(0,k),H(k,k),H(k,E.y*l),o.fillStyle=L+"0.2)",o.lineWidth=5,j(),t.attack&&(B(),o.arc(E.x*l+c,E.y*l+c,E.attackRange*l,0,D*2,!0),o.strokeStyle="rgba(255, 64, 64, 0.4)",o.lineWidth=2,o.stroke())}function R(e){var t=new Date(e.datetime);B(),o.fillStyle=L+"0.3)",o.rect(0,0,f*l,50),j(),o.font="bold 18pt monospace",o.fontWeight=800,o.fillStyle=A+"1)",F("t"+W(t.getHours(),"00",2)+":"+W(t.getMinutes(),"00",2),10,30),F(E.kills+" kills",140,30),F(E.age+" lifespan",280,30),F(O.round(E.health/10)+"%",f*l-75,30)}function U(e,t,n){x!==n&&(j(),B(),N=n.color,o.fillStyle=T="rgba("+_(N.r)+","+_(N.g)+","+_(N.b)+", 1);"),o.rect(e*l,t*l,l,l),x=n}function z(e,t){var n=this;n.action=e||function(){},t.onopen=function(){n.send({next:{ready:!0,map:!0,agents:!0,types:!0}})},t.onmessage=function(e){u=JSON.parse(e.data),f!==u.width&&(s.height=s.width=(f=u.height)*l),E=u.self,u.types&&(p=u.types),u.map&&(v=u.map),u.agents&&(C=u.agents);var t=n.action(u,u.self,a);t.next={ready:!0,agents:!0},n.send(t),h&&(q(u,t),R(u))},n.send=function(e){t.send(JSON.stringify(e))}}function W(e,t,n){return e=t+e,e.substring(e.length-n)}var t=window,n=null,r,i=document,s=i.getElementById("c"),o=s.getContext("2d"),u,a,f,l=7,c=3,h=!0,p,d,v,m,g,y,b,w,E,S,x,T,N,C=[],k,L="rgba(0,0,0,",A="rgba(255,255,255,",O=Math,M=O.pow,_=O.floor,D=Math.PI,P=Function.prototype;P.b=P.bind;var H=o.lineTo.b(o),B=o.beginPath.b(o),j=o.fill.b(o),F=o.fillText.b(o);t.ai={},t.onload=I})(this)