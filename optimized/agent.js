(function(e){function n(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}var t=require("./g");module.exports=function(i,s,o,u,a,f,l,c){var h=this;h.id=s+"",h.x=o,h.y=u,h.dir=t.rnd(8),h.type="human",h.birth=i,h.age=0,h.health=1e3,h.visionRange=30,h.vision=h.visionRange,h.attackRange=4,h.attackSize=2,h.attackStrength=100,h.skips=0,h.kills=0,h.next={ready:!0,agents:!0,map:!0,types:!0},h.act=function(t){if(h.next.ready){h.skips=0;var r={height:t.height,width:t.width,tps:t.tps,age:t.age,datetime:t.datetime,sunlight:t.sunlight,self:h};if(h.next.agents){var i,s={};for(var o in t.agents)i=t.agents[o],n(h,i)<h.vision&&(s[o]=i);r.agents=s}h.next.map&&(r.width=t.width,r.height=t.height,r.map=t.map,h.next.map=!1),h.next.types&&(r.types=t.types,h.next.types=!1),h.next={ready:!1};if(a)a.send(JSON.stringify(r));else if(f){var u=f(r,h,e);u.next={ready:!0,agents:!0},c(u)}}else h.skips+=1,h.skips>10&&(h.health+=-5);h.health<=0&&(a?a.close():f&&l())},a&&(a.on("message",function(e){var t=JSON.parse(e.utf8Data);c(t)}),a.on("close",function(e,t){console.log(new Date+" Disconnected."),l()}))}})(this)